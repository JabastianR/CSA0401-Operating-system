#include <stdio.h>
#include <fcntl.h>
#include <unistd.h>
#include <sys/stat.h>
#include <dirent.h>

int main() {
    int fd;
    struct stat st;
    DIR *dir;
    struct dirent *de;

    // Demonstrate open(), write(), lseek()
    fd = open("sample.txt", O_RDWR | O_CREAT, 0644);
    write(fd, "Operating Systems Lab\n", 22);
    lseek(fd, 0, SEEK_SET);  // Move file pointer to beginning

    // Demonstrate fcntl()
    int flags = fcntl(fd, F_GETFL);
    printf("File flags: %d\n", flags);

    // Demonstrate stat()
    stat("sample.txt", &st);
    printf("File Size: %ld bytes\n", st.st_size);
    printf("File Permissions: %o\n", st.st_mode & 0777);

    close(fd);

    // Demonstrate opendir() and readdir()
    dir = opendir(".");
    if (dir) {
        printf("\nFiles in current directory:\n");
        while ((de = readdir(dir)) != NULL)
            printf("%s\n", de->d_name);
        closedir(dir);
    }

    return 0;
}
